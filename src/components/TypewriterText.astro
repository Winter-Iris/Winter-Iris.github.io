---
export interface Props {
	text: string | string[];
	speed?: number;
	deleteSpeed?: number;
	pauseTime?: number;
	class?: string;
}

const {
	text,
	speed = 100,
	deleteSpeed = 50,
	pauseTime = 2000,
	class: className = "",
} = Astro.props;
const textData = Array.isArray(text) ? JSON.stringify(text) : text;
---

<span class={`typewriter ${className}`} data-text={textData} data-speed={speed} data-delete-speed={deleteSpeed} data-pause-time={pauseTime}></span>

<script>
import { TypewriterEffect } from "../utils/typewriter";

// 初始化逻辑保持不变
document.addEventListener('astro:page-load', () => {
    const typewriterElements = document.querySelectorAll('.typewriter');
    typewriterElements.forEach((element) => {
        new TypewriterEffect(element as HTMLElement);
    });
});
</script>

<style>
/* 样式保持不变 */
.typewriter {
    position: relative;
    min-height: 1.5em;
    display: inline-block;
    vertical-align: baseline;
}
.typewriter:empty::before {
    content: '\00A0';
    visibility: hidden;
}
</style>

<script>

    import { TypewriterEffect } from "../utils/typewriter";

    function initTypewriters() {
        const typewriterElements = document.querySelectorAll('.typewriter');
        typewriterElements.forEach((element) => {
            // 检查是否已经初始化过（避免重复打字），如果没有则初始化
            if (!(element as any)._typewriter) {
                (element as any)._typewriter = new TypewriterEffect(element as HTMLElement);
            }
        });
    }

    // 初始加载时运行
    document.addEventListener('DOMContentLoaded', initTypewriters);
    
    // 页面切换后运行 (这是关键！)
    document.addEventListener('swup:contentReplaced', initTypewriters);
</script>